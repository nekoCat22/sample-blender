# sample-blender
A web application for creating new audio samples by layering existing ones

## 設計の特徴
- モジュール性の高い設計
- プラグイン形式でのエフェクト追加が可能
- TypeScriptによる型安全な実装
- テスト容易性を考慮した構造

## 要件定義
### 1. 基本機能  
    - プリセットサンプル（約500個）の管理と選択
    - オプショナルなユーザーサンプルのアップロード機能
    - 2-3サンプルの同時再生と時間差再生
    - 波形表示機能
    - 作成したサンプルのwavファイルダウンロード
### 2. オーディオ処理機能
    - エフェクト処理
    - ゲイン調整
    - フィルター処理
    - ADSR制御
    - ピッチ調整
    - タイミング調整機能
### 3. UI要素
    - サンプルリスト表示（検索/フィルター機能付き）
    - ノブ型のパラメーター調整UI
    - 波形ビジュアライザー
    - 直感的な操作インターフェース
### 4. 対応フォーマット
    -入力: wav, mp3
    -出力: wav
### 5. 技術要件
    - フロントエンドのみの構成（バックエンド不要）
    - ブラウザでの動作
    - TypeScriptによる型安全な実装

## プロジェクト構造
```
プロジェクトルート/
  ├── src/           # ソースコード
  │   ├── components/     # Vueコンポーネント
  │   │   ├── AudioPlayer.vue     # メインの音声プレイヤーコンポーネント
  │   │   ├── WaveformDisplay.vue # 波形表示コンポーネント
  │   │   ├── Knob.vue            # パラメーター調整用ノブUI
  │   │   └── VolumeMeter.vue     # 音量レベル表示メーター
  │   │
  │   ├── types/         # TypeScript型定義
  │   ├── core/          # コアオーディオ処理
  │   │   └── AudioEngine.ts      # メインのオーディオエンジン
  │   │
  │   ├── effects/       # オーディオエフェクト
  │   │   ├── base/            # エフェクトの基底クラス
  │   │   ├── EffectChain.ts   # エフェクトチェーン管理
  │   │   ├── Filter.ts        # フィルターエフェクト
  │   │   └── GainEffect.ts    # ゲインコントロール
  │   │
  │   ├── assets/        # 静的ファイル
  │   ├── App.vue        # メインアプリケーションコンポーネント
  │   ├── main.ts        # アプリケーションのエントリーポイント
  │   └── shims-vue.d.ts # Vueの型定義
  │
  ├── tests/         # テストファイル
  ├── public/        # 静的ファイル
  ├── docs/          # ドキュメント
  ├── package.json   # プロジェクト設定
  └── README.md      # プロジェクト説明
```

## 音声信号経路
[サンプル1 (AudioBufferSourceNode)] --(出力)--> [GainNode1 (音量)] --(出力)--> [エフェクトチェーン1 (フィルター)] --(出力)-->
[サンプル2 (AudioBufferSourceNode)] --(出力)--> [GainNode2 (音量)] --(出力)--> [エフェクトチェーン2 (フィルター)] --(出力)--> [マスターエフェクトチェーン (フィルター)] --(出力)--> [マスターゲインノード] --(出力)--> [ステレオ出力]
[サンプル3 (AudioBufferSourceNode)] --(出力)--> [GainNode3 (音量)] --(出力)--> [エフェクトチェーン3 (フィルター)] --(出力)-->

1. **入力処理**
   - サンプルファイルの読み込み
   - オーディオバッファへの変換
   - メモリ管理

2. **エフェクトチェーン**
   - ゲインコントロール（GainNode）
   - フィルター処理

3. **出力処理**
   - マスターボリューム
   - 波形表示
   - WAVファイル出力

## 主要コンポーネントの役割
- **AudioEngine**: 全体のオーディオ処理を管理
- **AudioPlayer**: オーディオの再生、停止、波形表示などのUI制御
- **BaseEffect**: エフェクトの基底クラス。共通のインターフェースを提供
- **EffectChain**: エフェクトの接続と管理
- **Knob**: パラメーター調整用のUIコンポーネント
- **WaveformDisplay**: オーディオ波形の表示

## 開発ステップ
### Phase 1: 基礎的なオーディオ再生機能

1. プロジェクトのセットアップ
    - 開発環境の構築
    - Vue.js + TypeScriptの基本構造作成
    - 必要なライブラリのインストール
2. 基本的なオーディオ機能
    - 単一サンプルの再生/停止
    - 波形表示の実装
    - 基本的なUI作成

### Phase 2: 複数サンプル処理

1. 3つのサンプル同時再生
2. 基本的なミキシング機能
3. タイミング調整機能

### Phase 3: オーディオ処理機能

1. ✅ ゲイン調整
2. ✅ フィルター実装
   - ✅ Filter.tsの基本構造作成
     - ✅ クラスの定義と必要なプロパティの設定
     - ✅ コンストラクタでWeb Audio APIのBiquadFilterNodeを初期化
     - ✅ 基本的な接続メソッド（input/output）の実装
     - ✅ エラー処理の実装
   - ✅ フィルターのバイパス機能実装
     - ✅ フィルターのON/OFF切り替えメソッド
     - ✅ 0度の時の動作確認
     - ✅ エラー処理の確認
   - ✅ カットオフ周波数の制御実装
     - ✅ 回転角度からカットオフ周波数への変換関数
     - ✅ カットオフ周波数の設定メソッド
     - ✅ エラー処理の確認
   - ✅ フィルター動作の実装
     - ✅ ローパスフィルター（負の角度）の動作確認
     - ✅ ハイパスフィルター（正の角度）の動作確認
     - ✅ エラー処理の確認
   - ✅ AudioEngineへの統合
     - ✅ Filterクラスのインスタンス化
     - ✅ オーディオチェーンへの接続
     - ✅ エラー処理の確認
   - ✅ UIとの連携
     - ✅ ノブの回転角度とフィルター制御の連携
     - ✅ 動作確認とデバッグ
3. ✅ ピッチ調整
4. ADSR実装

### Phase 4: UI/UX改善

1. サンプルリスト実装
2. ノブUIの実装
3. 波形表示の改善

### Phase 5: 最終機能

1. WAVエクスポート機能
2. サンプルアップロード機能
3. 全体的な動作確認とバグ修正

## わかってる問題
- audioengineの責務が膨大

- 音量メーターがゴミ
　　原因はエフェクトチェーンの型らしい、要件等。AIからの提案↓
　　// 間違っていた実装
　　private effectChains: EffectChain[] = [];  // 配列として定義

　　// 正しい実装
　　private effectChains: Map<string, EffectChain> = new Map();  // Mapとして定義

## 開発環境のセットアップ

### 必要条件
- Node.js (v14以上)
- npm (v6以上)

### インストール
```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run serve

# ビルド
npm run build

# リント
npm run lint
```

### 型チェック
```bash
# TypeScriptの型チェック
npm run type-check
```

### テスト
```bash
# ユニットテストの実行
npm run test:unit
```

## カスタマイズ
設定の詳細については [Configuration Reference](https://cli.vuejs.org/config/) を参照してください。